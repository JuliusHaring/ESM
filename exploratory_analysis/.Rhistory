library(splines)
library(brms)
library(ggplot2)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
test_mode <- FALSE
filtered <- read.csv("../data/filtered.csv")
patient_grp <- filtered[filtered$REGISTRATION_ID < 2,]
patient_grp$ESM_ABDPAIN2 <- patient_grp$ESM_ABDPAIN + 1
control_grp <- filtered[filtered$REGISTRATION_ID > 2,]
control_grp$ESM_ABDPAIN2 <- control_grp$ESM_ABDPAIN + 1
columns <- names(control_grp)
columns <- columns[grepl("ESM_", columns)]
columns <- columns[!columns %in% c("ESM_ABDPAIN","ESM_ABDPAIN2","ESM_START","ESM_END")] # Removes ESM_ABDPAIN (target)
if(test_mode){
patient_grp <- control_grp[0:100,]
columns <- c("ESM_GAS2","ESM_GAS1")
}
to_test <- control_grp
for(marker in c("ESM_BLOAT3")){
try({
formula <- paste("ESM_ABDPAIN2~","s(",marker,",by=REGISTRATION_ID, bs='fs')")
if(test_mode){
formula <- paste("ESM_ABDPAIN2~","",marker)
}
formula <- as.formula(formula)
print(formula)
print(paste("NA: ", sum(is.na(to_test[marker]))))
print(paste("Available:", sum(!is.na(to_test[marker]))))
print("")
fit <- brm(formula, data=to_test, iter=1000, chains=1, family=cumulative("logit"))
summary(fit)
pp_check(fit)  # shows dens_overlay plot by default
pp_check(fit, type = "error_hist", nsamples = 11)
pp_check(fit, type = "scatter_avg", nsamples = 100)
pp_check(fit, type = "stat_2d")
pp_check(fit, type = "rootogram")
pp_check(fit, type = "loo_pit")
fname <- paste("../images/",marker,".jpeg", sep="")
jpeg(filename = fname,width=3.25,height=3.25,units="in",res=300)
print(plot(marginal_effects(fit), ask=FALSE, plot=FALSE)[[1]] + ggplot2::xlim(0,10) + ggplot2::ylim(1,11) +scale_y_continuous(name="ESM_ABDPAIN", limits=c(0, 10)))
dev.off()
dev.off()
})
}
pp_check(fit)  # shows dens_overlay plot by default
pp_check(fit, type = "error_hist", nsamples = 11)
pp_check(fit, type = "scatter_avg", nsamples = 100)
pp_check(fit, type = "stat_2d")
pp_check(fit, type = "rootogram")
pp_check(fit, type = "loo_pit")
pp_check(fit, type = "xyz")
pp_check(fit, type = "violin_grouped")
pp_check(fit, type = "violin_grouped", group="REGISTRATION_ID")
pp_check(fit, type = "freqpoly")
pp_check(fit, type = "ribbon")
pp_check(fit, type = "hist")
pp_check(fit, type = "stat")
pp_check(fit, type = "loo_intervals")
pp_check(fit, type = "scatter")
pp_check(fit, type = "boxplot")
pp_check(fit, type = "dens")
pp_check(fit, type = "violin")
pp_check(fit, type = "error_scatter")
